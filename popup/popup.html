<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ChatBackup</title>
  <link rel="stylesheet" href="popup.css" />
</head>
<body>
  <div class="container">
    <header class="header">
      <div class="logo">
        <div class="logo-badge">CB</div>
        <div>
          <div class="title">ChatBackup</div>
          <div class="subtitle">Backup do WhatsApp Web</div>
        </div>
      </div>
      <div class="version">v1.6.8</div>
    </header>

    <div id="status" class="status">
      <span id="dot" class="dot loading"></span>
      <span id="statusText">Verificando...</span>
    </div>

    <div id="wrongPage" class="alert hidden">
      âš ï¸ Abra <b>web.whatsapp.com</b> (aba ativa) e recarregue a pÃ¡gina.
    </div>

    <div class="card">
      <div class="cardTitle">ğŸ“‡ Selecionar Conversa</div>
      
      <button id="btnLoadContacts" class="btn secondary">ğŸ”„ Carregar Contatos</button>
      
      <div id="contactsContainer" class="hidden">
        <input type="text" id="searchContacts" class="input" placeholder="ğŸ” Buscar contato ou grupo...">
        
        <div id="contactsList" class="contacts-list">
          <!-- Lista serÃ¡ preenchida dinamicamente -->
        </div>
      </div>
      
      <div id="selectedContact" class="selected-contact hidden">
        <span id="selectedIcon">ğŸ‘¤</span>
        <span id="selectedName">Nenhum selecionado</span>
        <button id="btnClearSelection" class="btn-clear">âœ•</button>
      </div>
    </div>

    <div id="chatCard" class="card hidden">
      <div class="chatRow">
        <div class="avatar" id="chatAvatar">
          <img id="chatPhoto" src="" style="display: none; width: 40px; height: 40px; border-radius: 12px;" alt="Chat" />
          <span id="chatIcon">ğŸ’¬</span>
        </div>
        <div class="chatInfo">
          <div class="chatName" id="chatName">â€”</div>
          <div class="chatMeta" id="chatMeta">â€”</div>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="cardTitle">âš™ï¸ ExportaÃ§Ã£o</div>

      <label class="label">Formato</label>
      <select id="format" class="select">
        <option value="html">HTML (visual)</option>
        <option value="csv">CSV</option>
        <option value="json">JSON</option>
        <option value="txt">TXT</option>
      </select>

      <label class="label">Limite</label>
      <select id="limit" class="select">
        <option value="1000">1.000</option>
        <option value="5000">5.000</option>
        <option value="10000">10.000</option>
        <option value="50000">50.000</option>
        <option value="100000">100.000</option>
        <option value="-1">Todas</option>
      </select>

      <label class="label">Filtro de PerÃ­odo</label>
      <div style="display: flex; gap: 8px; margin-bottom: 8px;">
        <div style="flex: 1;">
          <label style="font-size: 11px; color: var(--muted); display: block; margin-bottom: 4px;">De:</label>
          <input type="date" id="dateFrom" class="select" style="padding: 8px;" />
        </div>
        <div style="flex: 1;">
          <label style="font-size: 11px; color: var(--muted); display: block; margin-bottom: 4px;">AtÃ©:</label>
          <input type="date" id="dateTo" class="select" style="padding: 8px;" />
        </div>
      </div>
      <div style="font-size: 10px; color: var(--muted); margin-bottom: 8px;">Deixe vazio para exportar tudo</div>

      <label class="check"><input id="incTs" type="checkbox" checked /> Incluir data/hora</label>
      <label class="check"><input id="incSender" type="checkbox" checked /> Incluir remetente</label>
    </div>

    <div class="card">
      <div class="cardTitle">ğŸ“¦ Exportar MÃ­dias (opcional)</div>
      
      <label class="check">
        <input type="checkbox" id="exportImages">
        <span>ğŸ–¼ï¸ Imagens</span>
      </label>
      
      <label class="check">
        <input type="checkbox" id="exportAudios">
        <span>ğŸµ Ãudios</span>
      </label>
      
      <label class="check">
        <input type="checkbox" id="exportDocs">
        <span>ğŸ“ Documentos</span>
      </label>
    </div>

    <div class="card">
      <button id="btnExport" class="btn primary">Exportar conversa</button>
      <button id="btnCancel" class="btn ghost hidden">Cancelar</button>

      <div id="progressBox" class="progress hidden">
        <div class="progressTop">
          <span id="progStatus">Preparandoâ€¦</span>
          <span id="progPct">0%</span>
        </div>
        <div class="bar"><div id="barFill" class="fill"></div></div>
        <div class="progressBottom"><span id="progDetail">â€”</span></div>
      </div>

      <div id="mediaProgressContainer" class="media-progress-container" style="display: none;">
        <div class="media-progress-title">ğŸ“Š Progresso de MÃ­dias:</div>
        
        <div id="imageProgress" class="media-progress-row" style="display: none;">
          <span class="media-icon">ğŸ–¼ï¸</span>
          <span class="media-label">Imagens:</span>
          <div class="media-bar-container">
            <div class="media-bar" id="imageBar"></div>
          </div>
          <span class="media-count" id="imageCount">0/0</span>
        </div>
        
        <div id="audioProgress" class="media-progress-row" style="display: none;">
          <span class="media-icon">ğŸµ</span>
          <span class="media-label">Ãudios:</span>
          <div class="media-bar-container">
            <div class="media-bar" id="audioBar"></div>
          </div>
          <span class="media-count" id="audioCount">0/0</span>
        </div>
        
        <div id="docProgress" class="media-progress-row" style="display: none;">
          <span class="media-icon">ğŸ“</span>
          <span class="media-label">Documentos:</span>
          <div class="media-bar-container">
            <div class="media-bar" id="docBar"></div>
          </div>
          <span class="media-count" id="docCount">0/0</span>
        </div>
      </div>

      <div class="hint">
        Para exportar tudo: selecione <b>Limite = Todas</b>.
      </div>
      
      <div id="exportHint" class="export-hint" style="display: none;">
        ğŸ’¡ O download continua mesmo se vocÃª fechar esta janela
      </div>
    </div>
    
    <!-- Toast notification -->
    <div id="toast" class="toast hidden">
      <span id="toastIcon">âœ…</span>
      <span id="toastMessage">Mensagem</span>
    </div>
  </div>

  <script src="popup.js"></script>
</body>
</html>
